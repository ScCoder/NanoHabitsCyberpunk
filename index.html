<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>–ù–∞–Ω–æ–ü—Ä–∏–≤—ã—á–∫–∏</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@400;500;600;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root { --bg: #0a0a0f; --bg-card: rgba(15, 15, 25, 0.8); --border: rgba(0, 245, 255, 0.15); --text: #ffffff; --text-dim: rgba(255, 255, 255, 0.5); --cyan: #00F5FF; --magenta: #FF00E5; --green: #00FF88; --yellow: #FFE500; --orange: #FF8C00; }
        body { font-family: 'Rajdhani', sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; -webkit-user-select: none; user-select: none; }
        #root { min-height: 100vh; position: relative; }
        .grid-overlay { position: fixed; inset: 0; background-image: linear-gradient(rgba(0, 245, 255, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 245, 255, 0.03) 1px, transparent 1px); background-size: 50px 50px; pointer-events: none; z-index: 0; }
        .vignette { position: fixed; inset: 0; background: radial-gradient(ellipse at center, transparent 0%, var(--bg) 100%); pointer-events: none; z-index: 0; }
        .particle-field { position: fixed; inset: 0; pointer-events: none; overflow: hidden; z-index: 0; }
        .particle { position: absolute; background: var(--cyan); border-radius: 50%; opacity: 0; animation: particle-float 5s ease-in-out infinite; }
        @keyframes particle-float { 0%, 100% { opacity: 0; transform: translateY(0); } 50% { opacity: 0.6; transform: translateY(-30px); } }
        .app-header { position: relative; padding: 24px 20px; border-bottom: 1px solid var(--border); background: linear-gradient(180deg, rgba(0, 245, 255, 0.05) 0%, transparent 100%); z-index: 10; }
        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .logo-section { display: flex; align-items: center; gap: 14px; }
        .logo-icon { width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, rgba(0, 245, 255, 0.1), rgba(255, 0, 229, 0.1)); border: 1px solid var(--border); cursor: pointer; position: relative; clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); transition: all 0.3s ease; }
        .logo-icon:hover { background: linear-gradient(135deg, rgba(0, 245, 255, 0.2), rgba(255, 0, 229, 0.2)); }
        .logo-diamond { font-size: 20px; color: var(--cyan); text-shadow: 0 0 10px var(--cyan); }
        .logo-text h1 { font-family: 'Orbitron', monospace; font-size: 18px; font-weight: 700; letter-spacing: 0.15em; background: linear-gradient(90deg, var(--cyan), var(--magenta)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .logo-text h1 span { color: var(--magenta); }
        .logo-version { font-size: 9px; color: var(--text-dim); letter-spacing: 0.3em; margin-top: 2px; }
        .stats-btn { width: 44px; height: 44px; background: var(--bg-card); border: 1px solid var(--border); color: var(--cyan); display: flex; align-items: center; justify-content: center; cursor: pointer; clip-path: polygon(15% 0, 100% 0, 100% 85%, 85% 100%, 0 100%, 0 15%); transition: all 0.3s ease; }
        .stats-btn:hover { background: rgba(0, 245, 255, 0.1); }
        .time-display { text-align: center; margin-bottom: 20px; }
        .time-value { font-family: 'Orbitron', monospace; font-size: 42px; font-weight: 700; letter-spacing: 0.05em; background: linear-gradient(90deg, var(--cyan), var(--magenta)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 30px rgba(0, 245, 255, 0.3); }
        .date-value { font-size: 13px; color: var(--text-dim); letter-spacing: 0.4em; margin-top: 4px; }
        .progress-container { padding: 0 4px; }
        .progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .progress-label { font-size: 11px; color: var(--text-dim); letter-spacing: 0.2em; }
        .progress-value { font-family: 'Orbitron', monospace; font-size: 13px; font-weight: 600; color: var(--cyan); }
        .progress-track { height: 8px; background: rgba(0, 245, 255, 0.1); border: 1px solid var(--border); position: relative; overflow: hidden; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, var(--cyan), var(--magenta)); position: relative; transition: width 0.5s ease; }
        .progress-glow { position: absolute; top: 0; right: 0; width: 20px; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5)); }
        .progress-markers { position: absolute; inset: 0; display: flex; justify-content: space-between; padding: 0 1px; }
        .progress-markers .marker { width: 1px; height: 100%; background: var(--border); }
        .progress-percent { text-align: right; font-family: 'Orbitron', monospace; font-size: 11px; color: var(--text-dim); margin-top: 6px; }
        .main-content { padding: 20px; padding-bottom: 100px; position: relative; z-index: 1; }
        .habits-list { display: flex; flex-direction: column; gap: 16px; }
        .habit-card { position: relative; background: var(--bg-card); border: 1px solid var(--border); padding: 20px; display: flex; align-items: center; gap: 16px; overflow: hidden; animation: slideIn 0.4s ease backwards; transition: all 0.3s ease; }
        .habit-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px; background: var(--accent); box-shadow: 0 0 15px var(--accent); }
        .habit-card.completed { background: linear-gradient(90deg, rgba(0, 255, 136, 0.05), transparent); border-color: var(--green); }
        .habit-card.completed::before { background: var(--green); box-shadow: 0 0 15px var(--green); }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        .card-glow { position: absolute; inset: 0; background: radial-gradient(ellipse at top left, rgba(0, 245, 255, 0.05), transparent 50%); pointer-events: none; }
        .card-scanline { position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, var(--accent), transparent); opacity: 0.3; animation: scanline 3s linear infinite; }
        @keyframes scanline { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
        .complete-btn { width: 52px; height: 52px; background: transparent; border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0; position: relative; clip-path: polygon(15% 0, 100% 0, 100% 85%, 85% 100%, 0 100%, 0 15%); transition: all 0.3s ease; }
        .complete-btn:hover { border-color: var(--accent); background: rgba(0, 245, 255, 0.1); }
        .complete-btn.done { background: var(--green); border-color: var(--green); }
        .complete-btn.done svg { width: 24px; height: 24px; stroke: var(--bg); }
        .btn-frame { display: flex; align-items: center; justify-content: center; }
        .btn-empty { width: 20px; height: 20px; border: 2px solid var(--text-dim); border-radius: 2px; }
        .habit-info { flex: 1; min-width: 0; }
        .habit-name { font-family: 'Orbitron', monospace; font-size: 15px; font-weight: 600; letter-spacing: 0.05em; color: var(--text); margin-bottom: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .habit-name.done { text-decoration: line-through; color: var(--text-dim); }
        .habit-meta { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
        .habit-schedule { font-size: 11px; color: var(--text-dim); letter-spacing: 0.15em; }
        .habit-streak { display: flex; align-items: center; gap: 4px; padding: 4px 10px; background: rgba(255, 229, 0, 0.1); border: 1px solid rgba(255, 229, 0, 0.3); }
        .streak-icon { font-size: 12px; }
        .streak-value { font-family: 'Orbitron', monospace; font-size: 12px; font-weight: 600; color: var(--yellow); }
        .habit-cheat { display: flex; align-items: center; gap: 4px; padding: 4px 10px; background: rgba(255, 140, 0, 0.1); border: 1px solid rgba(255, 140, 0, 0.3); }
        .cheat-icon { font-size: 12px; }
        .cheat-value { font-family: 'Orbitron', monospace; font-size: 12px; font-weight: 600; color: var(--orange); }
        .habit-actions { display: flex; gap: 8px; position: relative; }
        .cheat-btn { width: 36px; height: 36px; background: rgba(255, 140, 0, 0.1); border: 1px solid var(--orange); color: var(--orange); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 16px; transition: all 0.3s ease; }
        .cheat-btn:hover { background: var(--orange); color: var(--bg); }
        .cheat-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .cheat-btn:disabled:hover { background: rgba(255, 140, 0, 0.1); color: var(--orange); }
        .menu-btn { width: 36px; height: 36px; background: transparent; border: 1px solid var(--border); color: var(--text-dim); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; }
        .menu-btn:hover { border-color: var(--cyan); color: var(--cyan); }
        .menu-btn svg { pointer-events: none; }
        .dropdown-menu { position: absolute; right: 100%; top: 50%; transform: translateY(-50%); background: #0a0a0f; border: 1px solid var(--cyan); z-index: 1000; min-width: 180px; box-shadow: 0 4px 20px rgba(0, 245, 255, 0.3); margin-bottom: 8px; margin-right: 8px}
        .dropdown-menu button { width: 100%; display: flex; align-items: center; gap: 10px; padding: 14px 16px; background: none; border: none; color: var(--text); font-size: 13px; cursor: pointer; text-align: left; letter-spacing: 0.1em; }
        .dropdown-menu button:hover { background: rgba(0, 245, 255, 0.1); color: var(--cyan); }
        .dropdown-menu button.danger:hover { background: rgba(255, 51, 102, 0.1); color: #FF3366; }
        .fab { position: fixed; bottom: 30px; right: 20px; width: 64px; height: 64px; background: linear-gradient(135deg, var(--cyan), var(--magenta)); border: none; cursor: pointer; z-index: 100; display: flex; align-items: center; justify-content: center; clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); box-shadow: 0 0 30px rgba(0, 245, 255, 0.4); transition: all 0.3s ease; }
        .fab:hover { transform: scale(1.1) rotate(90deg); }
        .fab-inner { display: flex; align-items: center; justify-content: center; }
        .fab-inner svg { stroke: var(--bg); }
        .fab-ring { position: absolute; inset: -4px; border: 2px solid var(--cyan); clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); animation: pulse-ring 2s ease infinite; }
        @keyframes pulse-ring { 0%, 100% { opacity: 0.5; transform: scale(1); } 50% { opacity: 0; transform: scale(1.2); } }
        .empty-state { text-align: center; padding: 60px 20px; }
        .empty-hex { width: 80px; height: 80px; margin: 0 auto 24px; display: flex; align-items: center; justify-content: center; background: var(--bg-card); border: 1px solid var(--border); clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); }
        .empty-hex span { font-size: 32px; color: var(--cyan); opacity: 0.5; }
        .empty-state h2 { font-family: 'Orbitron', monospace; font-size: 18px; font-weight: 600; letter-spacing: 0.15em; color: var(--text-dim); margin-bottom: 12px; }
        .empty-state p { font-size: 14px; color: var(--text-dim); letter-spacing: 0.1em; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.9); z-index: 1000; display: flex; align-items: flex-start; justify-content: center; padding: 20px; overflow-y: auto; }
        .modal-content { width: 100%; max-width: 420px; background: var(--bg); border: 1px solid var(--border); padding: 24px; position: relative; margin-top: 20px; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 28px; }
        .modal-title { font-family: 'Orbitron', monospace; font-size: 16px; font-weight: 700; letter-spacing: 0.15em; color: var(--text); }
        .title-bracket { color: var(--cyan); margin: 0 4px; }
        .close-btn { width: 36px; height: 36px; background: transparent; border: 1px solid var(--border); color: var(--text-dim); display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .close-btn:hover { border-color: #FF3366; color: #FF3366; }
        .form-group { margin-bottom: 24px; }
        .form-label { display: block; font-size: 11px; color: var(--text-dim); letter-spacing: 0.2em; margin-bottom: 10px; }
        .cyber-input { width: 100%; background: var(--bg-card); border: 1px solid var(--border); padding: 16px; color: var(--text); font-family: 'Rajdhani', sans-serif; font-size: 16px; letter-spacing: 0.05em; outline: none; transition: all 0.3s ease; }
        .cyber-input:focus { border-color: var(--cyan); box-shadow: 0 0 20px rgba(0, 245, 255, 0.2); }
        .cyber-input::placeholder { color: var(--text-dim); }
        .toggle-container { display: flex; gap: 8px; }
        .toggle-btn { flex: 1; padding: 14px 12px; background: var(--bg-card); border: 1px solid var(--border); color: var(--text-dim); font-family: 'Rajdhani', sans-serif; font-size: 12px; font-weight: 600; letter-spacing: 0.15em; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.3s ease; }
        .toggle-btn:hover { border-color: var(--cyan); }
        .toggle-btn.active { background: rgba(0, 245, 255, 0.1); border-color: var(--cyan); color: var(--cyan); }
        .toggle-indicator { width: 8px; height: 8px; background: var(--text-dim); transition: all 0.3s ease; }
        .toggle-btn.active .toggle-indicator { background: var(--cyan); box-shadow: 0 0 10px var(--cyan); }
        .interval-control { display: flex; align-items: center; justify-content: center; gap: 16px; padding: 16px; background: var(--bg-card); border: 1px solid var(--border); }
        .interval-text { font-size: 12px; color: var(--text-dim); letter-spacing: 0.15em; }
        .interval-spinner { display: flex; align-items: center; gap: 12px; }
        .interval-spinner button { width: 40px; height: 40px; background: transparent; border: 1px solid var(--border); color: var(--cyan); font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .interval-spinner button:hover { background: rgba(0, 245, 255, 0.1); }
        .interval-value { font-family: 'Orbitron', monospace; font-size: 28px; font-weight: 700; color: var(--cyan); min-width: 50px; text-align: center; }
        .weekdays-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .weekday-btn { aspect-ratio: 1; background: var(--bg-card); border: 1px solid var(--border); color: var(--text-dim); cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 2px; transition: all 0.3s ease; }
        .weekday-btn:hover { border-color: var(--cyan); }
        .weekday-btn.active { background: rgba(0, 245, 255, 0.1); border-color: var(--cyan); color: var(--cyan); }
        .weekday-text { font-size: 12px; font-weight: 700; letter-spacing: 0.1em; }
        .cheat-control { display: flex; align-items: center; justify-content: center; gap: 16px; padding: 16px; background: var(--bg-card); border: 1px solid var(--border); }
        .cheat-control.disabled { opacity: 0.5; }
        .cheat-text { font-size: 12px; color: var(--text-dim); letter-spacing: 0.15em; }
        .cheat-spinner { display: flex; align-items: center; gap: 12px; }
        .cheat-spinner button { width: 40px; height: 40px; background: transparent; border: 1px solid var(--border); color: var(--orange); font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .cheat-spinner button:hover { background: rgba(255, 140, 0, 0.1); }
        .cheat-value-input { font-family: 'Orbitron', monospace; font-size: 28px; font-weight: 700; color: var(--orange); min-width: 50px; text-align: center; }
        .cheat-toggle { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .cheat-toggle label { font-size: 12px; color: var(--text-dim); letter-spacing: 0.1em; cursor: pointer; }
        .cheat-checkbox { width: 20px; height: 20px; accent-color: var(--orange); cursor: pointer; }
        .submit-btn { width: 100%; padding: 18px; background: linear-gradient(90deg, rgba(0, 245, 255, 0.1), rgba(255, 0, 229, 0.1)); border: 1px solid var(--cyan); color: var(--cyan); font-family: 'Orbitron', monospace; font-size: 14px; font-weight: 600; letter-spacing: 0.2em; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 12px; transition: all 0.3s ease; clip-path: polygon(0 0, calc(100% - 12px) 0, 100% 12px, 100% 100%, 12px 100%, 0 calc(100% - 12px)); }
        .submit-btn:hover { background: linear-gradient(90deg, var(--cyan), var(--magenta)); color: var(--bg); }
        .btn-icon { font-size: 16px; }
        .back-btn { width: 48px; height: 48px; background: var(--bg-card); border: 1px solid var(--border); color: var(--cyan); display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .back-btn:hover { background: rgba(0, 245, 255, 0.1); }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 20px; }
        .stat-card { background: var(--bg-card); border: 1px solid var(--border); padding: 20px 12px; text-align: center; }
        .stat-card.featured { border-color: var(--yellow); background: linear-gradient(180deg, rgba(255, 229, 0, 0.05), transparent); }
        .stat-icon { font-size: 20px; color: var(--cyan); margin-bottom: 8px; }
        .stat-card.featured .stat-icon { color: var(--yellow); }
        .stat-value { font-family: 'Orbitron', monospace; font-size: 28px; font-weight: 700; color: var(--text); }
        .stat-label { font-size: 9px; color: var(--text-dim); letter-spacing: 0.15em; margin-top: 6px; }
        .habits-analytics { padding: 0 20px 100px; display: flex; flex-direction: column; gap: 20px; }
        .analytics-card { position: relative; background: var(--bg-card); border: 1px solid var(--border); padding: 20px; overflow: hidden; animation: slideIn 0.4s ease backwards; }
        .analytics-header { display: flex; align-items: center; gap: 14px; margin-bottom: 20px; }
        .analytics-indicator { width: 12px; height: 12px; background: var(--accent); box-shadow: 0 0 10px var(--accent); clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%); }
        .analytics-info h3 { font-family: 'Orbitron', monospace; font-size: 14px; font-weight: 600; letter-spacing: 0.1em; color: var(--text); }
        .analytics-info span { font-size: 10px; color: var(--text-dim); letter-spacing: 0.2em; }
        .stats-row { display: flex; align-items: center; gap: 16px; margin-bottom: 20px; padding: 16px; background: rgba(0, 0, 0, 0.3); border: 1px solid var(--border); }
        .stat-item { flex: 1; text-align: center; }
        .stat-item-label { font-size: 9px; color: var(--text-dim); letter-spacing: 0.15em; margin-bottom: 6px; }
        .stat-item-value { font-family: 'Orbitron', monospace; font-size: 22px; font-weight: 700; color: var(--text); display: flex; align-items: center; justify-content: center; gap: 6px; }
        .stat-item-value.highlighted { color: var(--yellow); }
        .stat-icon-small { font-size: 14px; }
        .stat-divider { width: 1px; height: 40px; background: var(--border); }
        .heatmap-container { margin-bottom: 16px; }
        .heatmap { display: grid; grid-template-columns: repeat(30, 1fr); gap: 3px; margin-bottom: 8px; }
        .heatmap-cell { aspect-ratio: 1; background: rgba(255, 255, 255, 0.05); border: 1px solid transparent; transition: all 0.3s ease; }
        .heatmap-cell.active { background: var(--green); border-color: var(--green); box-shadow: 0 0 5px var(--green); }
        .heatmap-cell.cheat { background: var(--orange); border-color: var(--orange); box-shadow: 0 0 5px var(--orange); }
        .heatmap-cell.today { border-color: var(--cyan); }
        .heatmap-legend { display: flex; justify-content: space-between; font-size: 9px; color: var(--text-dim); letter-spacing: 0.1em; }
        .heatmap-legend-items { display: flex; gap: 16px; align-items: center; margin-top: 8px; justify-content: center; }
        .heatmap-legend-item { display: flex; align-items: center; gap: 6px; font-size: 9px; color: var(--text-dim); }
        .heatmap-legend-box { width: 12px; height: 12px; }
        .heatmap-legend-box.completed { background: var(--green); }
        .heatmap-legend-box.cheat { background: var(--orange); }
        .completion-bar { display: flex; align-items: center; gap: 12px; }
        .completion-bar-track { flex: 1; height: 6px; background: rgba(255, 255, 255, 0.1); position: relative; overflow: hidden; }
        .completion-bar-fill { height: 100%; background: linear-gradient(90deg, var(--cyan), var(--green)); position: relative; transition: width 0.5s ease; }
        .completion-bar-glow { position: absolute; right: 0; top: 0; width: 20px; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5)); }
        .completion-percent { font-family: 'Orbitron', monospace; font-size: 12px; color: var(--text-dim); min-width: 40px; text-align: right; }
        .praise-overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.95); z-index: 2000; display: flex; align-items: center; justify-content: center; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .praise-modal { text-align: center; animation: praiseIn 0.5s ease; }
        @keyframes praiseIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        .praise-ring { width: 120px; height: 120px; margin: 0 auto 24px; display: flex; align-items: center; justify-content: center; position: relative; }
        .praise-ring::before { content: ''; position: absolute; inset: 0; border: 3px solid var(--green); clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); animation: rotateRing 2s linear infinite; }
        @keyframes rotateRing { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .praise-ring-inner { position: absolute; inset: 10px; background: rgba(0, 255, 136, 0.1); clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); }
        .praise-check { font-size: 48px; color: var(--green); position: relative; z-index: 1; }
        .praise-text { font-family: 'Orbitron', monospace; font-size: 28px; font-weight: 800; letter-spacing: 0.2em; color: var(--green); margin-bottom: 12px; text-shadow: 0 0 40px var(--green); }
        .praise-subtitle { font-size: 12px; color: var(--green); letter-spacing: 0.3em; opacity: 0.7; }
        .cyber-confetti { position: fixed; inset: 0; pointer-events: none; z-index: 2001; overflow: hidden; }
        .confetti-piece { position: absolute; top: -10px; animation: confettiFall linear forwards; }
        @keyframes confettiFall { to { transform: translateY(110vh) rotate(720deg); } }
        .mood-stats-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 20px; }
        .mood-stat-card { background: var(--bg-card); border: 1px solid var(--border); padding: 16px; text-align: center; }
        .mood-stat-value { font-family: 'Orbitron', monospace; font-size: 24px; font-weight: 700; }
        .mood-stat-label { font-size: 9px; color: var(--text-dim); letter-spacing: 0.15em; margin-top: 4px; }
        .mood-btn { width: 54px; height: 54px; border: 2px solid; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center; clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); transition: all 0.3s ease; }
        .mood-btn:hover { transform: scale(1.1); }
        .mood-btn:active { transform: scale(0.95); }
        .mood-value { font-family: 'Orbitron', monospace; font-size: 16px; font-weight: 700; }
        .mood-btn.positive-4 { border-color: #00FF88; color: #00FF88; } .mood-btn.positive-4:hover { background: #00FF8820; }
        .mood-btn.positive-3 { border-color: #00F5FF; color: #00F5FF; } .mood-btn.positive-3:hover { background: #00F5FF20; }
        .mood-btn.positive-2 { border-color: #7EC8E3; color: #7EC8E3; } .mood-btn.positive-2:hover { background: #7EC8E320; }
        .mood-btn.positive-1 { border-color: #98D8AA; color: #98D8AA; } .mood-btn.positive-1:hover { background: #98D8AA20; }
        .mood-btn.neutral { border-color: #888888; color: #888888; } .mood-btn.neutral:hover { background: #88888820; }
        .mood-btn.negative-1 { border-color: #FFA07A; color: #FFA07A; } .mood-btn.negative-1:hover { background: #FFA07A20; }
        .mood-btn.negative-2 { border-color: #FF6B6B; color: #FF6B6B; } .mood-btn.negative-2:hover { background: #FF6B6B20; }
        .mood-btn.negative-3 { border-color: #FF3366; color: #FF3366; } .mood-btn.negative-3:hover { background: #FF336620; }
        .mood-btn.negative-4 { border-color: #FF0040; color: #FF0040; } .mood-btn.negative-4:hover { background: #FF004020; }
        .mood-chart-container { padding: 20px; margin-top: 10px; }
        .mood-chart { position: relative; height: 160px; background: var(--bg-card); border: 1px solid var(--border); padding: 10px 10px 10px 30px; }
        .mood-chart-grid { position: absolute; inset: 10px 10px 10px 30px; display: flex; flex-direction: column; justify-content: space-between; }
        .mood-chart-line { height: 1px; background: var(--border); position: relative; }
        .mood-chart-line span { position: absolute; left: -30px; top: -8px; font-size: 10px; color: var(--text-dim); font-family: 'Orbitron', monospace; }
        .mood-chart-points { position: absolute; inset: 10px 10px 10px 30px; }
        .mood-history-list { padding: 0 20px 100px; display: flex; flex-direction: column; gap: 8px; }
        .mood-entry { display: flex; align-items: center; gap: 14px; padding: 14px; background: var(--bg-card); border: 1px solid var(--border); animation: slideIn 0.3s ease backwards; }
        .mood-entry-indicator { width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; font-family: 'Orbitron', monospace; font-size: 16px; font-weight: 700; clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); }
        .mood-entry-info { flex: 1; }
        .mood-entry-time { font-size: 14px; font-weight: 600; color: var(--text); }
        .mood-entry-date { font-size: 11px; color: var(--text-dim); margin-top: 2px; }
        .mood-entry-delete { width: 32px; height: 32px; background: transparent; border: 1px solid var(--border); color: var(--text-dim); display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .mood-entry-delete:hover { border-color: #FF3366; color: #FF3366; }
        .export-mood-btn { display: flex; align-items: center; justify-content: center; gap: 12px; width: calc(100% - 40px); margin: 20px auto; padding: 16px; background: var(--bg-card); border: 1px solid var(--green); color: var(--green); font-family: 'Orbitron', monospace; font-size: 12px; font-weight: 600; letter-spacing: 0.15em; cursor: pointer; transition: all 0.3s ease; }
        .export-mood-btn:hover { background: rgba(0, 255, 136, 0.1); }
        .export-mood-btn:active { background: var(--green); color: var(--bg); }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
        const STORAGE_KEY = 'nanoHabitsV2', MOOD_STORAGE_KEY = 'nanoMoodV1';
        const COLORS = ['#00F5FF', '#FF00E5', '#00FF88', '#FFE500'];
        const PRAISES = ['–û–¢–õ–ò–ß–ù–û!', '–°–£–ü–ï–†!', '–ö–†–£–¢–û!', '–ú–û–õ–û–î–ï–¶!', '–í–ï–õ–ò–ö–û–õ–ï–ü–ù–û!'];
        const DAYS_SHORT = ['–ü–ù', '–í–¢', '–°–†', '–ß–¢', '–ü–¢', '–°–ë', '–í–°'];
        const MOOD_COLORS = { '-4': '#FF0040', '-3': '#FF3366', '-2': '#FF6B6B', '-1': '#FFA07A', '0': '#888888', '1': '#98D8AA', '2': '#7EC8E3', '3': '#00F5FF', '4': '#00FF88' };
        const MOOD_LABELS = { '-4': '–£–ñ–ê–°–ù–û', '-3': '–ü–õ–û–•–û', '-2': '–ì–†–£–°–¢–ù–û', '-1': '–¢–ê–ö –°–ï–ë–ï', '0': '–ù–ï–ô–¢–†–ê–õ–¨–ù–û', '1': '–ù–û–†–ú–ê–õ–¨–ù–û', '2': '–•–û–†–û–®–û', '3': '–û–¢–õ–ò–ß–ù–û', '4': '–ü–†–ï–ö–†–ê–°–ù–û' };
        let habits = [], moodEntries = [], currentView = 'main';

        function init() { loadHabits(); loadMoodEntries(); renderParticles(); render(); updateTime(); setInterval(updateTime, 1000); }
        function loadHabits() { 
            const s = localStorage.getItem(STORAGE_KEY); 
            habits = s ? JSON.parse(s) : []; 
            // –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—è cheatCode –∏ cheatDates –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
            habits = habits.map(h => ({
                ...h,
                cheatCode: h.cheatCode !== undefined ? h.cheatCode : null,
                cheatDates: h.cheatDates || []
            }));
        }
        function saveHabits() { localStorage.setItem(STORAGE_KEY, JSON.stringify(habits)); }
        function loadMoodEntries() { const s = localStorage.getItem(MOOD_STORAGE_KEY); moodEntries = s ? JSON.parse(s) : []; }
        function saveMoodEntries() { localStorage.setItem(MOOD_STORAGE_KEY, JSON.stringify(moodEntries)); }
        function getTodayStr() { return new Date().toISOString().split('T')[0]; }

        function isHabitDueToday(h) {
            const t = new Date(), d = (t.getDay() + 6) % 7;
            if (h.scheduleType === 'weekdays') return h.weekdays.includes(d);
            if (h.completedDates.length === 0) return true;
            const last = new Date(h.completedDates[h.completedDates.length - 1]);
            return Math.floor((t - last) / 864e5) >= h.interval;
        }
        function isCompletedToday(h) { return h.completedDates.includes(getTodayStr()); }

        // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –†–ê–°–ß–Å–¢–ê –°–ï–†–ò–ò –ë–ï–ó –ü–†–û–ü–£–°–ö–û–í
        function getCurrentStreak(habit) {
            if (habit.completedDates.length === 0) return 0;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const todayStr = today.toISOString().split('T')[0];
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∞—Ç—ã –ø–æ —É–±—ã–≤–∞–Ω–∏—é (–æ—Ç –Ω–æ–≤—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º)
            const sortedDates = [...habit.completedDates].sort().reverse();
            
            if (habit.scheduleType === 'interval') {
                const interval = habit.interval || 1;
                
                const lastCompletedDate = new Date(sortedDates[0]);
                lastCompletedDate.setHours(0, 0, 0, 0);
                const daysSinceLast = Math.floor((today - lastCompletedDate) / 864e5);
                
                // –ï—Å–ª–∏ –ø—Ä–æ—à–ª–æ –±–æ–ª—å—à–µ —á–µ–º interval –¥–Ω–µ–π —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è - —Å–µ—Ä–∏—è –ø—Ä–µ—Ä–≤–∞–Ω–∞
                if (daysSinceLast > interval) {
                    return 0;
                }
                
                // –°—á–∏—Ç–∞–µ–º —Å–µ—Ä–∏—é
                let streak = 1;
                let prevDate = new Date(sortedDates[0]);
                
                for (let i = 1; i < sortedDates.length; i++) {
                    const currDate = new Date(sortedDates[i]);
                    const diffDays = Math.floor((prevDate - currDate) / 864e5);
                    
                    // –î–ª—è interval-–ø—Ä–∏–≤—ã—á–µ–∫: —Ä–∞–∑–Ω–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–∞–≤–Ω–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª—É 
                    if (diffDays === interval) {
                        streak++;
                        prevDate = currDate;
                    } else if (diffDays < interval) {
                        // –ï—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–Ω—å—à–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ - —ç—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                        continue;
                    } else {
                        // –°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π —Ä–∞–∑—Ä—ã–≤ - —Å–µ—Ä–∏—è –ø—Ä–µ—Ä–≤–∞–Ω–∞
                        break;
                    }
                }
                
                return streak;
                
            } else if (habit.scheduleType === 'weekdays') {
                const weekdays = habit.weekdays || [];
                if (weekdays.length === 0) return 0;
                
                // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –¥–µ–Ω—å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º
                const isScheduledDay = (date) => {
                    const dayOfWeek = (date.getDay() + 6) % 7; // –ü–ù=0, –í–°=6
                    return weekdays.includes(dayOfWeek);
                };
                
                // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–Ω–µ–π –æ—Ç —Å–µ–≥–æ–¥–Ω—è –Ω–∞–∑–∞–¥
                const getScheduledDays = (fromDate, count) => {
                    const days = [];
                    let d = new Date(fromDate);
                    while (days.length < count) {
                        if (isScheduledDay(d)) {
                            days.push(d.toISOString().split('T')[0]);
                        }
                        d.setDate(d.getDate() - 1);
                    }
                    return days;
                };
                
                // –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 365 –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–Ω–µ–π
                const scheduledDays = getScheduledDays(today, 365);
                const completedSet = new Set(sortedDates);
                
                let streak = 0;
                let startIdx = 0;
                
                // –ï—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–µ–Ω—å –∏ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ - –Ω–∞—á–∏–Ω–∞–µ–º —Å–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ
                if (scheduledDays[0] === todayStr && !completedSet.has(todayStr)) {
                    startIdx = 1;
                }
                
                // –°—á–∏—Ç–∞–µ–º —Å–µ—Ä–∏—é
                for (let i = startIdx; i < scheduledDays.length; i++) {
                    if (completedSet.has(scheduledDays[i])) {
                        streak++;
                    } else {
                        break;
                    }
                }
                
                return streak;
            }
            
            return 0;
        }

        // –ü–æ–¥—Å—á—ë—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —á–∏—Ç-–∫–æ–¥–æ–≤
        function getAvailableCheatCodes(habit) {
            if (!habit.cheatCode || habit.cheatCode <= 0) return 0;
            
            // –°—á–∏—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ –æ–±—ã—á–Ω—ã–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–±–µ–∑ —á–∏—Ç-–∫–æ–¥–æ–≤)
            const cheatDatesSet = new Set(habit.cheatDates || []);
            const regularCompletions = habit.completedDates.filter(d => !cheatDatesSet.has(d)).length;
            
            // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —á–∏—Ç-–∫–æ–¥–æ–≤
            const earnedCheats = Math.floor(regularCompletions / habit.cheatCode);
            
            // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —á–∏—Ç-–∫–æ–¥–æ–≤
            const usedCheats = (habit.cheatDates || []).length;
            
            return Math.max(0, earnedCheats - usedCheats);
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —á–∏—Ç-–∫–æ–¥–∞
        function useCheatCode(id) {
            const habit = habits.find(h => h.id === id);
            if (!habit) return;
            
            const available = getAvailableCheatCodes(habit);
            if (available <= 0) {
                showNotification('‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —á–∏—Ç-–∫–æ–¥–æ–≤!', 'error');
                return;
            }
            
            const todayStr = getTodayStr();
            if (habit.completedDates.includes(todayStr)) {
                showNotification('‚ùå –£–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è!', 'error');
                return;
            }
            
            habits = habits.map(h => {
                if (h.id === id) {
                    return {
                        ...h,
                        completedDates: [...h.completedDates, todayStr],
                        cheatDates: [...(h.cheatDates || []), todayStr]
                    };
                }
                return h;
            });
            
            saveHabits();
            showCheatConfirmation();
            render();
        }

        function showCheatConfirmation() {
            const o = document.createElement('div'); 
            o.className = 'praise-overlay';
            o.innerHTML = '<div class="praise-modal"><div class="praise-ring"><div class="praise-ring-inner" style="background:rgba(255, 140, 0, 0.2)"></div><span style="font-family:Orbitron;font-size:48px;font-weight:800;color:var(--orange);text-shadow:0 0 30px var(--orange)">üéÆ</span></div><h2 class="praise-text" style="color:var(--orange);text-shadow:0 0 40px var(--orange)">–ß–ò–¢-–ö–û–î!</h2><div class="praise-subtitle" style="color:var(--orange)">–ó–ê–ü–õ–ê–ù–ò–†–û–í–ê–ù–ù–´–ô –ü–†–û–ü–£–°–ö</div></div>';
            document.body.appendChild(o); 
            setTimeout(() => o.remove(), 1500); 
            o.onclick = () => o.remove();
        }

        function completeHabit(id) { 
            const t = getTodayStr(); 
            habits = habits.map(h => h.id === id && !h.completedDates.includes(t) ? {...h, completedDates: [...h.completedDates, t]} : h); 
            saveHabits(); 
            showPraise(); 
            render(); 
        }
        
        function deleteHabit(id) { habits = habits.filter(h => h.id !== id); saveHabits(); render(); }
        
        function addHabit(h) { habits.push(h); saveHabits(); render(); }
        
        function updateHabit(id, updates) {
            habits = habits.map(h => h.id === id ? {...h, ...updates} : h);
            saveHabits();
            render();
        }
        
        function addMoodEntry(v) { moodEntries.push({ id: Date.now(), value: v, timestamp: new Date().toISOString() }); saveMoodEntries(); showMoodConfirmation(v); render(); }
        function deleteMoodEntry(id) { moodEntries = moodEntries.filter(e => e.id !== id); saveMoodEntries(); render(); }

        function showMoodConfirmation(v) {
            const c = MOOD_COLORS[v], l = MOOD_LABELS[v];
            const o = document.createElement('div'); o.className = 'praise-overlay';
            o.innerHTML = '<div class="praise-modal"><div class="praise-ring"><div class="praise-ring-inner" style="background:'+c+'20"></div><span style="font-family:Orbitron;font-size:48px;font-weight:800;color:'+c+';text-shadow:0 0 30px '+c+'">'+(v>0?'+':'')+v+'</span></div><h2 class="praise-text" style="color:'+c+';text-shadow:0 0 40px '+c+'">'+l+'</h2><div class="praise-subtitle" style="color:'+c+'">–ù–ê–°–¢–†–û–ï–ù–ò–ï –ó–ê–ü–ò–°–ê–ù–û</div></div>';
            document.body.appendChild(o); setTimeout(() => o.remove(), 1500); o.onclick = () => o.remove();
        }

        function updateTime() { const now = new Date(); const timeEl = document.querySelector('.time-value'); const dateEl = document.querySelector('.date-value'); if (timeEl) timeEl.textContent = now.toTimeString().slice(0,8); if (dateEl) dateEl.textContent = now.toLocaleDateString('ru-RU'); }

        function getMoodStats() { if (moodEntries.length === 0) return { count: 0, avg: 0, max: 0 }; const vals = moodEntries.map(e => e.value); return { count: moodEntries.length, avg: (vals.reduce((a,b) => a+b, 0) / vals.length).toFixed(1), max: Math.max(...vals) }; }
        function renderMoodChart() { if (moodEntries.length < 2) return ''; const recent = [...moodEntries].slice(-50); const w = 100 / recent.length; return recent.map((e, i) => { const y = 50 - (e.value * 12.5); const c = MOOD_COLORS[e.value]; return '<div style="position:absolute;left:'+(i*w)+'%;bottom:'+(50-y)+'%;width:'+w+'%;height:4px"><div style="width:8px;height:8px;background:'+c+';border-radius:50%;margin:auto;box-shadow:0 0 10px '+c+'"></div></div>'; }).join(''); }

        function showPraise() {
            const p = PRAISES[Math.floor(Math.random()*PRAISES.length)];
            const o = document.createElement('div'); o.className = 'praise-overlay';
            o.innerHTML = renderConfetti()+'<div class="praise-modal"><div class="praise-ring"><div class="praise-ring-inner"></div><span class="praise-check">‚úì</span></div><h2 class="praise-text">'+p+'</h2><div class="praise-subtitle">–ü–†–û–¢–û–ö–û–õ –í–´–ü–û–õ–ù–ï–ù</div></div>';
            document.body.appendChild(o); setTimeout(() => o.remove(), 1800); o.onclick = () => o.remove();
        }
        function renderConfetti() { const cc = ['#00F5FF','#FF00E5','#00FF88','#FFE500','#FF3366']; let h = '<div class="cyber-confetti">'; for (let i = 0; i < 80; i++) { const l = Math.random()*100, dl = Math.random()*0.5, du = 1+Math.random()*1.5, c = cc[Math.floor(Math.random()*cc.length)], s = 4+Math.random()*8; h += '<div class="confetti-piece" style="left:'+l+'%;animation-delay:'+dl+'s;animation-duration:'+du+'s;background:'+c+';box-shadow:0 0 10px '+c+';width:'+s+'px;height:'+s+'px"></div>'; } return h + '</div>'; }
        function renderParticles() { const c = document.createElement('div'); c.className = 'particle-field'; for (let i = 0; i < 50; i++) { const p = document.createElement('div'); p.className = 'particle'; p.style.left = Math.random()*100+'%'; p.style.top = Math.random()*100+'%'; p.style.width = p.style.height = (1+Math.random()*2)+'px'; p.style.animationDuration = (3+Math.random()*4)+'s'; p.style.animationDelay = Math.random()*5+'s'; c.appendChild(p); } document.getElementById('root').appendChild(c); }

        function showAddModal() {
            const weekdaysHtml = DAYS_SHORT.map(function(d,i) { return '<button class="weekday-btn" data-day="'+i+'"><span class="weekday-text">'+d+'</span></button>'; }).join('');
            const m = document.createElement('div'); m.className = 'modal-overlay';
            m.innerHTML = '<div class="modal-content" onclick="event.stopPropagation()"><div class="modal-header"><div class="modal-title"><span class="title-bracket">[</span>–ù–û–í–´–ô –ü–†–û–¢–û–ö–û–õ<span class="title-bracket">]</span></div><button class="close-btn" onclick="this.closest(\'.modal-overlay\').remove()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></div><div class="form-group"><label class="form-label">–ò–î–ï–ù–¢–ò–§–ò–ö–ê–¢–û–†</label><input type="text" id="habitName" class="cyber-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ..." autofocus></div><div class="form-group"><label class="form-label">–¶–ò–ö–õ –ü–û–í–¢–û–†–ï–ù–ò–Ø</label><div class="toggle-container"><button class="toggle-btn active" data-type="interval"><span class="toggle-indicator"></span>–ò–ù–¢–ï–†–í–ê–õ</button><button class="toggle-btn" data-type="weekdays"><span class="toggle-indicator"></span>–î–ù–ò –ù–ï–î–ï–õ–ò</button></div></div><div class="form-group" id="intervalSection"><div class="interval-control"><span class="interval-text">–ö–ê–ñ–î–´–ï</span><div class="interval-spinner"><button onclick="changeInterval(-1)">‚àí</button><span class="interval-value" id="intervalValue">01</span><button onclick="changeInterval(1)">+</button></div><span class="interval-text" id="intervalUnit">–î–ï–ù–¨</span></div></div><div class="form-group hidden" id="weekdaysSection"><div class="weekdays-grid">'+weekdaysHtml+'</div></div><div class="form-group"><label class="form-label">–ß–ò–¢-–ö–û–î (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–ø—É—Å–∫)</label><div class="cheat-toggle"><input type="checkbox" id="cheatEnabled" class="cheat-checkbox" onchange="toggleCheatSection()"><label for="cheatEnabled">–í–∫–ª—é—á–∏—Ç—å —á–∏—Ç-–∫–æ–¥</label></div><div class="cheat-control disabled" id="cheatSection"><span class="cheat-text">–ß–ï–†–ï–ó</span><div class="cheat-spinner"><button onclick="changeCheatCode(-1)">‚àí</button><span class="cheat-value-input" id="cheatValue">07</span><button onclick="changeCheatCode(1)">+</button></div><span class="cheat-text">–í–´–ü–û–õ–ù–ï–ù–ò–ô</span></div></div><button class="submit-btn" onclick="submitHabit()"><span class="btn-text">–ê–ö–¢–ò–í–ò–†–û–í–ê–¢–¨</span><span class="btn-icon">‚ñ∂</span></button></div>';
            document.body.appendChild(m); 
            m.onclick = () => m.remove();
            m.querySelectorAll('.toggle-btn').forEach(b => { 
                b.onclick = function(ev) { 
                    ev.stopPropagation();
                    m.querySelectorAll('.toggle-btn').forEach(x => x.classList.remove('active')); 
                    this.classList.add('active'); 
                    if (this.dataset.type === 'interval') { 
                        m.querySelector('#intervalSection').classList.remove('hidden'); 
                        m.querySelector('#weekdaysSection').classList.add('hidden'); 
                    } else { 
                        m.querySelector('#intervalSection').classList.add('hidden'); 
                        m.querySelector('#weekdaysSection').classList.remove('hidden'); 
                    } 
                }; 
            });
            m.querySelectorAll('.weekday-btn').forEach(b => { b.onclick = function(ev) { ev.stopPropagation(); this.classList.toggle('active'); }; });
        }

        function showEditModal(id) {
            const habit = habits.find(h => h.id === id);
            if (!habit) return;
            
            const intervalVal = String(habit.interval || 1).padStart(2,'0');
            const intervalUnit = (habit.interval || 1) === 1 ? '–î–ï–ù–¨' : (habit.interval || 1) < 5 ? '–î–ù–Ø' : '–î–ù–ï–ô';
            const cheatVal = String(habit.cheatCode || 7).padStart(2,'0');
            const weekdaysHtml = DAYS_SHORT.map(function(d,i) { return '<button class="weekday-btn '+(habit.weekdays && habit.weekdays.includes(i) ? 'active' : '')+'" data-day="'+i+'"><span class="weekday-text">'+d+'</span></button>'; }).join('');
            
            const m = document.createElement('div'); m.className = 'modal-overlay';
            m.innerHTML = '<div class="modal-content" onclick="event.stopPropagation()"><div class="modal-header"><div class="modal-title"><span class="title-bracket">[</span>–†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï<span class="title-bracket">]</span></div><button class="close-btn" onclick="this.closest(\'.modal-overlay\').remove()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></div><div class="form-group"><label class="form-label">–ò–î–ï–ù–¢–ò–§–ò–ö–ê–¢–û–†</label><input type="text" id="editHabitName" class="cyber-input" value="'+habit.name+'"></div><div class="form-group"><label class="form-label">–¶–ò–ö–õ –ü–û–í–¢–û–†–ï–ù–ò–Ø</label><div class="toggle-container"><button class="toggle-btn '+(habit.scheduleType === 'interval' ? 'active' : '')+'" data-type="interval"><span class="toggle-indicator"></span>–ò–ù–¢–ï–†–í–ê–õ</button><button class="toggle-btn '+(habit.scheduleType === 'weekdays' ? 'active' : '')+'" data-type="weekdays"><span class="toggle-indicator"></span>–î–ù–ò –ù–ï–î–ï–õ–ò</button></div></div><div class="form-group '+(habit.scheduleType === 'weekdays' ? 'hidden' : '')+'" id="editIntervalSection"><div class="interval-control"><span class="interval-text">–ö–ê–ñ–î–´–ï</span><div class="interval-spinner"><button onclick="changeEditInterval(-1)">‚àí</button><span class="interval-value" id="editIntervalValue">'+intervalVal+'</span><button onclick="changeEditInterval(1)">+</button></div><span class="interval-text" id="editIntervalUnit">'+intervalUnit+'</span></div></div><div class="form-group '+(habit.scheduleType === 'interval' ? 'hidden' : '')+'" id="editWeekdaysSection"><div class="weekdays-grid">'+weekdaysHtml+'</div></div><div class="form-group"><label class="form-label">–ß–ò–¢-–ö–û–î (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–ø—É—Å–∫)</label><div class="cheat-toggle"><input type="checkbox" id="editCheatEnabled" class="cheat-checkbox" '+(habit.cheatCode ? 'checked' : '')+' onchange="toggleEditCheatSection()"><label for="editCheatEnabled">–í–∫–ª—é—á–∏—Ç—å —á–∏—Ç-–∫–æ–¥</label></div><div class="cheat-control '+(habit.cheatCode ? '' : 'disabled')+'" id="editCheatSection"><span class="cheat-text">–ß–ï–†–ï–ó</span><div class="cheat-spinner"><button onclick="changeEditCheatCode(-1)">‚àí</button><span class="cheat-value-input" id="editCheatValue">'+cheatVal+'</span><button onclick="changeEditCheatCode(1)">+</button></div><span class="cheat-text">–í–´–ü–û–õ–ù–ï–ù–ò–ô</span></div></div><button class="submit-btn" onclick="submitEditHabit('+id+')"><span class="btn-text">–°–û–•–†–ê–ù–ò–¢–¨</span><span class="btn-icon">‚úì</span></button></div>';
            document.body.appendChild(m); 
            m.onclick = () => m.remove();
            m.querySelectorAll('.toggle-btn').forEach(b => { 
                b.onclick = function(ev) { 
                    ev.stopPropagation();
                    m.querySelectorAll('.toggle-btn').forEach(x => x.classList.remove('active')); 
                    this.classList.add('active'); 
                    if (this.dataset.type === 'interval') { 
                        m.querySelector('#editIntervalSection').classList.remove('hidden'); 
                        m.querySelector('#editWeekdaysSection').classList.add('hidden'); 
                    } else { 
                        m.querySelector('#editIntervalSection').classList.add('hidden'); 
                        m.querySelector('#editWeekdaysSection').classList.remove('hidden'); 
                    } 
                }; 
            });
            m.querySelectorAll('.weekday-btn').forEach(b => { b.onclick = function(ev) { ev.stopPropagation(); this.classList.toggle('active'); }; });
        }

        window.toggleCheatSection = function() {
            const enabled = document.getElementById('cheatEnabled').checked;
            const section = document.getElementById('cheatSection');
            if (enabled) {
                section.classList.remove('disabled');
            } else {
                section.classList.add('disabled');
            }
        };

        window.toggleEditCheatSection = function() {
            const enabled = document.getElementById('editCheatEnabled').checked;
            const section = document.getElementById('editCheatSection');
            if (enabled) {
                section.classList.remove('disabled');
            } else {
                section.classList.add('disabled');
            }
        };

        window.changeInterval = function(d) { 
            const v = document.getElementById('intervalValue'), u = document.getElementById('intervalUnit'); 
            let n = Math.max(1, parseInt(v.textContent) + d); 
            v.textContent = String(n).padStart(2,'0'); 
            u.textContent = n === 1 ? '–î–ï–ù–¨' : n < 5 ? '–î–ù–Ø' : '–î–ù–ï–ô'; 
        };

        window.changeEditInterval = function(d) { 
            const v = document.getElementById('editIntervalValue'), u = document.getElementById('editIntervalUnit'); 
            let n = Math.max(1, parseInt(v.textContent) + d); 
            v.textContent = String(n).padStart(2,'0'); 
            u.textContent = n === 1 ? '–î–ï–ù–¨' : n < 5 ? '–î–ù–Ø' : '–î–ù–ï–ô'; 
        };

        window.changeCheatCode = function(d) { 
            const v = document.getElementById('cheatValue'); 
            let n = Math.max(1, parseInt(v.textContent) + d); 
            v.textContent = String(n).padStart(2,'0'); 
        };

        window.changeEditCheatCode = function(d) { 
            const v = document.getElementById('editCheatValue'); 
            let n = Math.max(1, parseInt(v.textContent) + d); 
            v.textContent = String(n).padStart(2,'0'); 
        };

        window.submitHabit = function() { 
            const n = document.getElementById('habitName').value.trim(); 
            if (!n) return; 
            const t = document.querySelector('.toggle-btn.active').dataset.type; 
            const iv = t === 'interval' ? parseInt(document.getElementById('intervalValue').textContent) : null; 
            const wd = t === 'weekdays' ? Array.from(document.querySelectorAll('.weekday-btn.active')).map(b => parseInt(b.dataset.day)) : null; 
            if (t === 'weekdays' && wd.length === 0) return; 
            
            const cheatEnabled = document.getElementById('cheatEnabled').checked;
            const cheatCode = cheatEnabled ? parseInt(document.getElementById('cheatValue').textContent) : null;
            
            addHabit({ 
                id: Date.now(), 
                name: n, 
                scheduleType: t, 
                interval: iv, 
                weekdays: wd, 
                completedDates: [], 
                cheatCode: cheatCode,
                cheatDates: [],
                createdAt: new Date().toISOString(), 
                color: COLORS[Math.floor(Math.random()*COLORS.length)] 
            }); 
            document.querySelector('.modal-overlay').remove(); 
        };

        window.submitEditHabit = function(id) { 
            const n = document.getElementById('editHabitName').value.trim(); 
            if (!n) return; 
            const m = document.querySelector('.modal-overlay');
            const t = m.querySelector('.toggle-btn.active').dataset.type; 
            const iv = t === 'interval' ? parseInt(document.getElementById('editIntervalValue').textContent) : null; 
            const wd = t === 'weekdays' ? Array.from(m.querySelectorAll('.weekday-btn.active')).map(b => parseInt(b.dataset.day)) : null; 
            if (t === 'weekdays' && (!wd || wd.length === 0)) return; 
            
            const cheatEnabled = document.getElementById('editCheatEnabled').checked;
            const cheatCode = cheatEnabled ? parseInt(document.getElementById('editCheatValue').textContent) : null;
            
            updateHabit(id, { 
                name: n, 
                scheduleType: t, 
                interval: iv, 
                weekdays: wd,
                cheatCode: cheatCode
            }); 
            m.remove(); 
            showNotification('‚úÖ –ü—Ä–∏–≤—ã—á–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!', 'success');
        };

        function render() { if (currentView === 'history') renderHistory(); else if (currentView === 'mood') renderMoodTracker(); else renderMain(); }

        function renderMain() {
            const th = habits.filter(h => isHabitDueToday(h) || isCompletedToday(h));
            const ct = th.filter(h => isCompletedToday(h)).length;
            const pr = th.length > 0 ? (ct/th.length)*100 : 0;
            document.getElementById('root').innerHTML = '<div class="grid-overlay"></div><div class="vignette"></div><header class="app-header"><div class="header-row"><div class="logo-section"><div class="logo-icon" onclick="showMoodTracker()"><span class="logo-diamond">‚óà</span></div><div class="logo-text"><h1>–ù–ê–ù–û<span>–ü–†–ò–í–´–ß–ö–ò</span></h1><div class="logo-version">SYS.VERSION 2.1</div></div></div><button class="stats-btn" onclick="showDataMenu()" style="margin-right:12px"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5-5m0 0l5 5m-5-5v12"/></svg></button><button class="stats-btn" onclick="showHistory()"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><path d="M18 9l-5 5-4-4-3 3"/></svg></button></div><div class="time-display"><div class="time-value">00:00:00</div><div class="date-value">01.01.2024</div></div>'+(th.length > 0 ? '<div class="progress-container"><div class="progress-header"><span class="progress-label">–ü–†–û–ì–†–ï–°–° –°–ï–°–°–ò–ò</span><span class="progress-value">'+ct+'/'+th.length+'</span></div><div class="progress-track"><div class="progress-bar" style="width:'+pr+'%"><div class="progress-glow"></div></div><div class="progress-markers">'+[0,25,50,75,100].map(p => '<div class="marker" style="left:'+p+'%"></div>').join('')+'</div></div><div class="progress-percent">'+Math.round(pr)+'%</div></div>' : '')+'</header><main class="main-content">'+(th.length === 0 ? '<div class="empty-state"><div class="empty-hex"><span>‚óá</span></div><h2>–ù–ï–¢ –ê–ö–¢–ò–í–ù–´–• –ü–†–û–¢–û–ö–û–õ–û–í</h2><p>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã</p></div>' : '<div class="habits-list">'+th.map((h,i) => renderHabitCard(h,i)).join('')+'</div>')+'</main><button class="fab" onclick="showAddModal()"><div class="fab-inner"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg></div><div class="fab-ring"></div></button>';
            renderParticles(); updateTime();
        }

        function renderHabitCard(h, i) {
            const c = isCompletedToday(h);
            const sc = h.scheduleType === 'interval' ? (h.interval === 1 ? '–ï–ñ–ï–î–ù–ï–í–ù–û' : '–ö–ê–ñ–î–´–ï '+h.interval+' –î.') : h.weekdays.map(d => DAYS_SHORT[d]).join(' ¬∑ ');
            const st = h.completedDates.length;
            const availableCheats = getAvailableCheatCodes(h);
            const showCheatBtn = h.cheatCode && !c && availableCheats > 0;
            
            return '<div class="habit-card '+(c?'completed':'')+'" style="--accent:'+h.color+';animation-delay:'+(i*0.1)+'s"><div class="card-glow"></div><div class="card-scanline"></div><button class="complete-btn '+(c?'done':'')+'" onclick="completeHabit('+h.id+')"><div class="btn-frame">'+(c?'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M5 13l4 4L19 7" stroke-linecap="round" stroke-linejoin="round"/></svg>':'<div class="btn-empty"></div>')+'</div></button><div class="habit-info"><h3 class="habit-name '+(c?'done':'')+'">'+h.name+'</h3><div class="habit-meta"><span class="habit-schedule">'+sc+'</span>'+(st>0?'<span class="habit-streak"><span class="streak-icon">‚ö°</span><span class="streak-value">'+st+'</span></span>':'')+(h.cheatCode?'<span class="habit-cheat"><span class="cheat-icon">üéÆ</span><span class="cheat-value">'+availableCheats+'</span></span>':'')+'</div></div><div class="habit-actions">'+(showCheatBtn?'<button class="cheat-btn" onclick="useCheatCode('+h.id+')" title="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á–∏—Ç-–∫–æ–¥">üéÆ</button>':'')+'<button class="menu-btn" onclick="toggleMenu(event,'+h.id+')"><svg width="4" height="16" viewBox="0 0 4 16"><circle cx="2" cy="2" r="2" fill="currentColor"/><circle cx="2" cy="8" r="2" fill="currentColor"/><circle cx="2" cy="14" r="2" fill="currentColor"/></svg></button></div></div>';
        }

        window.toggleMenu = function(e, id) { 
            e.stopPropagation(); 
            const ex = document.querySelector('.dropdown-menu'); 
            if (ex) { ex.remove(); return; } 
            const m = document.createElement('div'); 
            m.className = 'dropdown-menu'; 
            m.innerHTML = '<button onclick="showEditModal('+id+');this.closest(\'.dropdown-menu\').remove()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>–†–ï–î–ê–ö–¢–ò–†–û–í–ê–¢–¨</button><button class="danger" onclick="deleteHabit('+id+');this.closest(\'.dropdown-menu\').remove()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2m3 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6h14z"/></svg>–£–î–ê–õ–ò–¢–¨</button>'; 
            const btn = e.currentTarget;
            btn.parentElement.appendChild(m); 
            setTimeout(() => document.addEventListener('click', function cl() { if(document.querySelector('.dropdown-menu')) document.querySelector('.dropdown-menu').remove(); document.removeEventListener('click', cl); }), 10); 
        };

        window.showHistory = function() { currentView = 'history'; renderHistory(); };
        window.hideHistory = function() { currentView = 'main'; render(); };
        window.showMoodTracker = function() { currentView = 'mood'; render(); };
        window.hideMoodTracker = function() { currentView = 'main'; render(); };

        function renderHistory() {
            const tc = habits.reduce((s,h) => s + h.completedDates.length, 0);
            const bs = Math.max(0, ...habits.map(h => getCurrentStreak(h)));
            const last30 = []; for (let i = 29; i >= 0; i--) { const d = new Date(); d.setDate(d.getDate()-i); last30.push(d.toISOString().split('T')[0]); }
            document.getElementById('root').innerHTML = '<div class="grid-overlay"></div><div class="vignette"></div><header class="app-header"><div class="header-row"><button class="back-btn" onclick="hideHistory()"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg></button><div class="logo-section"><div class="logo-icon"><span class="logo-diamond">‚óà</span></div><div class="logo-text"><h1>–ê–ù–ê–õ–ò–¢–ò–ö–ê</h1><div class="logo-version">–°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–†–û–¢–û–ö–û–õ–û–í</div></div></div><div style="width:48px"></div></div></header><div class="stats-grid"><div class="stat-card"><div class="stat-icon">‚óà</div><div class="stat-value">'+String(habits.length).padStart(2,'0')+'</div><div class="stat-label">–ü–†–û–¢–û–ö–û–õ–û–í</div></div><div class="stat-card"><div class="stat-icon">‚óâ</div><div class="stat-value">'+String(tc).padStart(2,'0')+'</div><div class="stat-label">–í–´–ü–û–õ–ù–ï–ù–û</div></div><div class="stat-card featured"><div class="stat-icon">‚ö°</div><div class="stat-value">'+String(bs).padStart(2,'0')+'</div><div class="stat-label">–ú–ê–ö–°. –°–ï–†–ò–Ø</div></div></div><div class="habits-analytics">'+habits.map((h,i) => { 
                const tc = h.completedDates.length; 
                const st = getCurrentStreak(h); 
                const cr = Math.round((h.completedDates.filter(d => last30.includes(d)).length/30)*100); 
                const cheatDatesSet = new Set(h.cheatDates || []);
                return '<div class="analytics-card" style="--accent:'+h.color+';animation-delay:'+(i*0.1)+'s"><div class="card-glow"></div><div class="card-scanline"></div><div class="analytics-header"><div class="analytics-indicator"></div><div class="analytics-info"><h3>'+h.name+'</h3><span>–ú–û–ù–ò–¢–û–†–ò–ù–ì –ê–ö–¢–ò–í–ù–û–°–¢–ò</span></div></div><div class="stats-row"><div class="stat-item"><div class="stat-item-label">–í–°–ï–ì–û –í–´–ü–û–õ–ù–ï–ù–ò–ô</div><div class="stat-item-value"><span class="stat-icon-small">‚óâ</span>'+String(tc).padStart(2,'0')+'</div></div><div class="stat-divider"></div><div class="stat-item"><div class="stat-item-label">–ë–ï–ó –ü–†–û–ü–£–°–ö–û–í</div><div class="stat-item-value highlighted"><span class="stat-icon-small">‚ö°</span>'+String(st).padStart(2,'0')+'</div></div></div><div class="heatmap-container"><div class="heatmap">'+last30.map(d => {
                    const isCheat = cheatDatesSet.has(d);
                    const isCompleted = h.completedDates.includes(d);
                    const isToday = d === getTodayStr();
                    let classes = 'heatmap-cell';
                    if (isCheat) classes += ' cheat';
                    else if (isCompleted) classes += ' active';
                    if (isToday) classes += ' today';
                    return '<div class="'+classes+'"></div>';
                }).join('')+'</div><div class="heatmap-legend"><span>30 –î–ù–ï–ô –ù–ê–ó–ê–î</span><span>–°–ï–ì–û–î–ù–Ø</span></div>'+(h.cheatCode ? '<div class="heatmap-legend-items"><div class="heatmap-legend-item"><div class="heatmap-legend-box completed"></div><span>–í—ã–ø–æ–ª–Ω–µ–Ω–æ</span></div><div class="heatmap-legend-item"><div class="heatmap-legend-box cheat"></div><span>–ß–∏—Ç-–∫–æ–¥</span></div></div>' : '')+'</div><div class="completion-bar"><div class="completion-bar-track"><div class="completion-bar-fill" style="width:'+cr+'%"><div class="completion-bar-glow"></div></div></div><div class="completion-percent">'+cr+'%</div></div></div>'; 
            }).join('')+(habits.length===0?'<div class="empty-state"><div class="empty-hex"><span>‚óá</span></div><h2>–ù–ï–¢ –î–ê–ù–ù–´–•</h2><p>–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è</p></div>':'')+'</div>';
            renderParticles();
        }

        function renderMoodTracker() {
            const st = getMoodStats(), re = [...moodEntries].reverse().slice(0,50);
            document.getElementById('root').innerHTML = '<div class="grid-overlay"></div><div class="vignette"></div><header class="app-header"><div class="header-row"><button class="back-btn" onclick="hideMoodTracker()"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg></button><div class="logo-section"><div class="logo-icon"><span class="logo-diamond">‚óà</span></div><div class="logo-text"><h1>–ù–ê–°–¢–†–û–ï–ù–ò–ï</h1><div class="logo-version">–≠–ú–û–¶–ò–û–ù–ê–õ–¨–ù–´–ô –¢–†–ï–ö–ï–†</div></div></div><div style="width:48px"></div></div></header><div style="padding:20px;text-align:center"><div style="font-size:12px;color:var(--text-dim);letter-spacing:0.2em;margin-bottom:16px">–ö–ê–ö –í–´ –°–ï–ë–Ø –ß–£–í–°–¢–í–£–ï–¢–ï?</div><div style="display:flex;flex-direction:column;gap:12px;align-items:center"><div style="display:flex;gap:12px;justify-content:center"><span style="font-size:10px;color:#00FF88;letter-spacing:0.1em;align-self:center;margin-right:8px">–ü–†–ï–ö–†–ê–°–ù–û</span>'+[4,3,2,1].map(v => { return '<button class="mood-btn positive-'+v+'" onclick="addMoodEntry('+v+')"><span class="mood-value">+'+v+'</span></button>'; }).join('')+'</div><div style="display:flex;gap:12px;justify-content:center"><span style="font-size:10px;color:#888;letter-spacing:0.1em;align-self:center;margin-right:8px">–ù–ï–ô–¢–†–ê–õ–¨–ù–û</span><button class="mood-btn neutral" onclick="addMoodEntry(0)"><span class="mood-value">0</span></button></div><div style="display:flex;gap:12px;justify-content:center">'+[-1,-2,-3,-4].map(v => { return '<button class="mood-btn negative-'+Math.abs(v)+'" onclick="addMoodEntry('+v+')"><span class="mood-value">'+v+'</span></button>'; }).join('')+'<span style="font-size:10px;color:#FF0040;letter-spacing:0.1em;align-self:center;margin-right:8px">–£–ñ–ê–°–ù–û</span></div></div></div><div class="mood-stats-row"><div class="mood-stat-card"><div class="mood-stat-value" style="color:var(--cyan)">'+st.count+'</div><div class="mood-stat-label">–ó–ê–ü–ò–°–ï–ô</div></div><div class="mood-stat-card"><div class="mood-stat-value" style="color:'+(st.avg>=0?'#00FF88':'#FF3366')+'">'+(st.avg>0?'+':'')+st.avg+'</div><div class="mood-stat-label">–°–†–ï–î–ù–ï–ï</div></div><div class="mood-stat-card"><div class="mood-stat-value" style="color:'+MOOD_COLORS[st.max]+'">'+(st.max>0?'+':'')+st.max+'</div><div class="mood-stat-label">–ú–ê–ö–°–ò–ú–£–ú</div></div></div>'+(moodEntries.length>=2?'<div class="mood-chart-container"><div style="font-size:12px;color:var(--text-dim);letter-spacing:0.15em;margin-bottom:8px">–ì–†–ê–§–ò–ö –ù–ê–°–¢–†–û–ï–ù–ò–Ø</div><div class="mood-chart"><div class="mood-chart-grid"><div class="mood-chart-line"><span>+4</span></div><div class="mood-chart-line"><span>+2</span></div><div class="mood-chart-line"><span>0</span></div><div class="mood-chart-line"><span>-2</span></div><div class="mood-chart-line"><span>-4</span></div></div><div class="mood-chart-points">'+renderMoodChart()+'</div></div></div>':'')+'<button class="export-mood-btn" onclick="exportMoodData()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5-5m0 0l5 5m-5-5v12"/></svg>–≠–ö–°–ü–û–†–¢ –ò–°–¢–û–†–ò–ò</button><div style="padding:0 20px;margin-bottom:12px"><div style="font-size:12px;color:var(--text-dim);letter-spacing:0.15em">–ò–°–¢–û–†–ò–Ø –ó–ê–ü–ò–°–ï–ô</div></div><div class="mood-history-list">'+(re.length===0?'<div class="empty-state" style="padding:40px 20px"><div class="empty-hex"><span>‚óá</span></div><h2>–ù–ï–¢ –ó–ê–ü–ò–°–ï–ô</h2><p>–û—Ç–º–µ—Ç—å—Ç–µ —Å–≤–æ—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤—ã—à–µ</p></div>':re.map((e,i) => { const d = new Date(e.timestamp), c = MOOD_COLORS[e.value], l = MOOD_LABELS[e.value]; return '<div class="mood-entry" style="animation-delay:'+(i*0.05)+'s"><div class="mood-entry-indicator" style="background:'+c+'20;border:2px solid '+c+';color:'+c+'">'+(e.value>0?'+':'')+e.value+'</div><div class="mood-entry-info"><div class="mood-entry-time">'+d.toLocaleTimeString('ru-RU',{hour:'2-digit',minute:'2-digit'})+' ¬∑ '+l+'</div><div class="mood-entry-date">'+d.toLocaleDateString('ru-RU',{day:'2-digit',month:'long',year:'numeric'})+'</div></div><button class="mood-entry-delete" onclick="deleteMoodEntry('+e.id+')"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></div>'; }).join(''))+'</div>';
            renderParticles();
        }

        function exportData() { try { const d = { version: '2.1', exportDate: new Date().toISOString(), habits: habits }; const j = JSON.stringify(d,null,2), f = 'nanohabits-backup-'+new Date().toISOString().split('T')[0]+'.json'; if (typeof AndroidInterface !== 'undefined') AndroidInterface.exportData(j,f); else { const b = new Blob([j],{type:'application/json'}), u = URL.createObjectURL(b), a = document.createElement('a'); a.href = u; a.download = f; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(u); showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!','success'); } } catch(e) { showNotification('‚ùå –û—à–∏–±–∫–∞: '+e.message,'error'); } }
        
        function exportMoodData() { try { const d = { version: '1.0', exportDate: new Date().toISOString(), moodEntries: moodEntries }; const j = JSON.stringify(d,null,2), f = 'nanomood-backup-'+new Date().toISOString().split('T')[0]+'.json'; if (typeof AndroidInterface !== 'undefined') AndroidInterface.exportData(j,f); else { const b = new Blob([j],{type:'application/json'}), u = URL.createObjectURL(b), a = document.createElement('a'); a.href = u; a.download = f; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(u); showNotification('‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ!','success'); } } catch(e) { showNotification('‚ùå –û—à–∏–±–∫–∞: '+e.message,'error'); } }
        
        function importData() { try { if (typeof AndroidInterface !== 'undefined') AndroidInterface.importData(); else { const i = document.createElement('input'); i.type = 'file'; i.accept = '.json'; i.onchange = function(e) { const f = e.target.files[0]; if (!f) return; const r = new FileReader(); r.onload = function(ev) { try { processImportedData(JSON.parse(ev.target.result)); } catch(e) { showNotification('‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è','error'); } }; r.readAsText(f); }; i.click(); } } catch(e) { showNotification('‚ùå –û—à–∏–±–∫–∞: '+e.message,'error'); } }
        function processImportedData(d) { if (!d.habits || !Array.isArray(d.habits)) { showNotification('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç','error'); return; } showImportConfirmDialog(d); }
        function showImportConfirmDialog(d) { const hc = d.habits.length, cc = habits.length, ed = new Date(d.exportDate).toLocaleDateString('ru-RU'), ds = encodeURIComponent(JSON.stringify(d)); const m = document.createElement('div'); m.className = 'modal-overlay'; m.innerHTML = '<div class="modal-content" onclick="event.stopPropagation()"><div class="modal-header"><div class="modal-title"><span class="title-bracket">[</span>–ò–ú–ü–û–†–¢ –î–ê–ù–ù–´–•<span class="title-bracket">]</span></div><button class="close-btn" onclick="this.closest(\'.modal-overlay\').remove()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></div><div style="margin:24px 0;padding:20px;border:1px solid var(--border);background:var(--bg-card)"><div style="display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--border)"><span style="font-size:12px;color:var(--text-dim)">–¢–ï–ö–£–©–ò–ï:</span><span style="font-family:Orbitron;font-size:18px;color:var(--cyan);font-weight:700">'+cc+'</span></div><div style="display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--border)"><span style="font-size:12px;color:var(--text-dim)">–í –§–ê–ô–õ–ï:</span><span style="font-family:Orbitron;font-size:18px;color:var(--cyan);font-weight:700">'+hc+'</span></div><div style="display:flex;justify-content:space-between;padding:12px 0"><span style="font-size:12px;color:var(--text-dim)">–î–ê–¢–ê:</span><span style="font-family:Orbitron;font-size:18px;color:var(--cyan);font-weight:700">'+ed+'</span></div></div><div style="text-align:center;color:var(--yellow);margin:20px 0;font-size:14px">‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:</div><button class="submit-btn" onclick="confirmImportData(\''+ds+'\',\'merge\')" style="margin-bottom:12px"><span class="btn-text">–û–ë–™–ï–î–ò–ù–ò–¢–¨</span></button><button class="submit-btn" onclick="confirmImportData(\''+ds+'\',\'replace\')" style="background:transparent;color:#FF3366;border-color:#FF3366"><span class="btn-text">–ó–ê–ú–ï–ù–ò–¢–¨ –í–°–ï</span></button></div>'; document.body.appendChild(m); m.onclick = () => m.remove(); }
        window.confirmImportData = function(ds, md) { try { const d = JSON.parse(decodeURIComponent(ds)); if (md === 'replace') habits = d.habits; else { const ei = new Set(habits.map(h => h.id)); habits = habits.concat(d.habits.filter(h => !ei.has(h.id))); } saveHabits(); render(); document.querySelector('.modal-overlay').remove(); showNotification('‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: '+d.habits.length,'success'); } catch(e) { showNotification('‚ùå –û—à–∏–±–∫–∞: '+e.message,'error'); } };
        function showNotification(m, t) { const n = document.createElement('div'); n.textContent = m; n.style.cssText = 'position:fixed;top:20px;left:50%;transform:translateX(-50%);background:'+(t==='success'?'#00FF88':t==='error'?'#FF3366':'#00F5FF')+';color:#0a0a0f;padding:16px 24px;border-radius:8px;font-weight:700;z-index:10000;box-shadow:0 4px 20px rgba(0,0,0,0.5)'; document.body.appendChild(n); setTimeout(() => { n.style.opacity = '0'; n.style.transition = 'opacity 0.3s'; setTimeout(() => n.remove(), 300); }, 3000); }
        window.showDataMenu = function() { const hc = habits.length, tc = habits.reduce((s,h) => s+h.completedDates.length, 0); const m = document.createElement('div'); m.className = 'modal-overlay'; m.innerHTML = '<div class="modal-content" onclick="event.stopPropagation()"><div class="modal-header"><div class="modal-title"><span class="title-bracket">[</span>–£–ü–†–ê–í–õ–ï–ù–ò–ï –î–ê–ù–ù–´–ú–ò<span class="title-bracket">]</span></div><button class="close-btn" onclick="this.closest(\'.modal-overlay\').remove()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></div><div style="display:flex;gap:12px;margin:24px 0"><div style="flex:1;padding:20px;border:1px solid var(--border);background:var(--bg-card);display:flex;align-items:center;gap:16px"><span style="font-size:32px;color:var(--cyan)">‚óà</span><div><div style="font-family:Orbitron;font-size:28px;font-weight:700;color:var(--text)">'+hc+'</div><div style="font-size:10px;color:var(--text-dim);margin-top:4px">–ü–†–ò–í–´–ß–ï–ö</div></div></div><div style="flex:1;padding:20px;border:1px solid var(--border);background:var(--bg-card);display:flex;align-items:center;gap:16px"><span style="font-size:32px;color:var(--cyan)">‚óâ</span><div><div style="font-family:Orbitron;font-size:28px;font-weight:700;color:var(--text)">'+tc+'</div><div style="font-size:10px;color:var(--text-dim);margin-top:4px">–í–´–ü–û–õ–ù–ï–ù–ò–ô</div></div></div></div><button onclick="exportData();this.closest(\'.modal-overlay\').remove()" style="width:100%;display:flex;align-items:center;gap:20px;padding:20px;margin-bottom:12px;border:1px solid #00FF88;background:var(--bg-card);color:var(--text);cursor:pointer"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#00FF88" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5-5m0 0l5 5m-5-5v12"/></svg><div style="text-align:left"><div style="font-size:16px;font-weight:700">–≠–ö–°–ü–û–†–¢</div><div style="font-size:12px;color:var(--text-dim)">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Downloads</div></div></button><button onclick="importData();this.closest(\'.modal-overlay\').remove()" style="width:100%;display:flex;align-items:center;gap:20px;padding:20px;border:1px solid #00F5FF;background:var(--bg-card);color:var(--text);cursor:pointer"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#00F5FF" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5 5m0 0l-5-5m5 5V3"/></svg><div style="text-align:left"><div style="font-size:16px;font-weight:700">–ò–ú–ü–û–†–¢</div><div style="font-size:12px;color:var(--text-dim)">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ —Ñ–∞–π–ª–∞</div></div></button></div>'; document.body.appendChild(m); m.onclick = () => m.remove(); };

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
